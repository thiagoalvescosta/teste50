!function(o){function e(o){var e=[].slice.call(arguments,1),t=0;return o.replace(/%s/g,function(){return e[t++]})}angular.module("upload.services",[]).service("UploadService",["$http","$compile","$modal","Upload",function(o,e,t,a){var n=$("body");angular.element(n.get(0)).scope();this.upload=function(o){t.open({templateUrl:"plugins/cronapp-framework-js/components/upload/upload.html",controller:"UploadController",resolve:{data:function(){return o}}})}.bind(this)}]),angular.module("custom.controllers").controller("UploadController",["$scope","$http","$translate","$stateParams","$location","$http","$modalInstance","data",function(o,t,a,n,r,t,i,l){app.registerEventsCronapi(o,a),o.params=n,o.$http=t;var s=r.search();for(var p in s)s.hasOwnProperty(p)&&(o.params[p]=s[p]);o.files=[],o.uploading=!1,o.uploaded=!0,o.progress=0,o.data=l,o.message=a.instant("Upload.oneFile"),"true"==l.multiple&&(o.message=a.instant("Upload.multipleFile")),l.description&&(o.message=l.description),o.safeApply=safeApply,o.uploadFile=function(n){var r="api/cronapi/upload/"+l.id,i=new FormData;if(0==n.length)this.Notification.error(e(a.instant("Upload.errorValidation"),l.maxSize,l.filter));else{for(var s=0;s<n.length;s++)i.append("file",n[s]),console.log(n[s].$valid);var p=JSON.parse(sessionStorage.getItem("_u"));this.$promise=t({method:"POST",url:(window.hostApp||"")+r,data:i,headers:{"Content-Type":void 0,"X-AUTH-TOKEN":p.token},onProgress:function(e){this.safeApply(function(){if(e.lengthComputable){var t=e.loaded/e.total*100|0;o.progress=t}o.uploading=!0,console.log(t)})}.bind(this)}).success(function(e,t,a,n){this.cronapi.evalInContext(JSON.stringify(e));o.uploaded=!0,o.uploading=!1,o.close()}.bind(this)).error(function(e,t,a){this.Notification.error(e.error),o.uploading=!1,o.close()}.bind(this))}}.bind(o),o.close=function(){i.dismiss("cancel")}}])}(app);